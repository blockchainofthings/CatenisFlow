<script type="text/javascript">
    RED.nodes.registerType('log message', {
        category: 'Catenis Flow',
        color: '#9f9fe4',
        defaults: {
            name: { value: "" },
            connection: { value: "", type: "catenis api connection", required: true },
            encoding: { value: "utf8" },
            encrypt: { value: true },
            offChain: { value: true },
            storage: { value: "auto" },
            async: { value: false }
        },
        inputs:1,
        outputs:1,
        icon: "log_message.svg",
        label: function () {
            return this.name || "Log message";
        }
    });
</script>

<script type="text/html" data-template-name="log message">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-connection"><i class="fa fa-exchange"></i> Connection</label>
        <input type="text" id="node-input-connection">
    </div>
    <div class="form-row">
        <hr>
    </div>
    <div class="form-row">
        <label for="node-input-encoding"><i class="fa fa-font"></i> Encoding</label>
        <select id="node-input-encoding">
            <option value="utf8" selected>UTF-8</option>
            <option value="base64">Base-64</option>
            <option value="hex">Hex</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-encrypt"><i class="fa fa-user-secret"></i> Encrypt</label>
        <input type="checkbox" id="node-input-encrypt">
    </div>
    <div class="form-row">
        <label for="node-input-offChain"><i class="fa fa-envelope"></i> Off-Chain</label>
        <input type="checkbox" id="node-input-offChain">
    </div>
    <div class="form-row">
        <label for="node-input-storage"><i class="fa fa-archive"></i> Storage</label>
        <select id="node-input-storage">
            <option value="auto" selected>Auto</option>
            <option value="embedded">Embedded</option>
            <option value="external">External</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-async"><i class="fa fa-refresh"></i> Async</label>
        <input type="checkbox" id="node-input-async">
    </div>
</script>

<script type="text/html" data-help-name="log message">
    <p>Call Catenis API "Log Message" method to record a message to the blockchain.</p>
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">string</span></dt>
        <dd>The message to record</dd>
    </dl>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object</span></dt>
        <dt style="margin-left:1em">message<span class="property-type">string | object</span></dt>
        <dd style="margin-left:1.5em">The message to record</dd>
        <dt style="margin-left:2em" class="optional">data<span class="property-type">string</span></dt>
        <dd style="margin-left:2.5em">The message data chunk</dd>
        <dt style="margin-left:2em" class="optional">isFinal<span class="property-type">boolean</span></dt>
        <dd style="margin-left:2.5em">Indicates whether this is the final message data chunk</dd>
        <dt style="margin-left:2em" class="optional">continuationToken<span class="property-type">string</span></dt>
        <dd style="margin-left:2.5em">Token required to send this continuation message data chunk</dd>
        <dt style="margin-left:1em" class="optional">options<span class="property-type">object</span></dt>
        <dt style="margin-left:2em" class="optional">encoding<span class="property-type">string</span></dt>
        <dd style="margin-left:2.5em">Specifies the encoding of the message. One of: <code>utf8</code>, <code>base64</code>, <code>hex</code></dd>
        <dt style="margin-left:2em" class="optional">encrypt<span class="property-type">boolean</span></dt>
        <dd style="margin-left:2.5em">Indicates whether message should be encrypted before storing it</dd>
        <dt style="margin-left:2em" class="optional">offChain<span class="property-type">boolean</span></dt>
        <dd style="margin-left:2.5em">Indicates whether message should be logged as a Catenis off-chain message</dd>
        <dt style="margin-left:2em" class="optional">storage<span class="property-type">string</span></dt>
        <dd style="margin-left:2.5em">Specifies where the message should be stored. One of: <code>auto</code>, <code>embedded</code>, <code>external</code></dd>
        <dt style="margin-left:2em" class="optional">async<span class="property-type">boolean</span></dt>
        <dd style="margin-left:2.5em">Indicates whether processing should be done asynchronously</dd>
    </dl>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object</span></dt>
        <dt style="margin-left:1em" class="optional">continuationToken<span class="property-type">string</span></dt>
        <dd style="margin-left:1.5em">Token to be used to send next message data chunk</dd>
        <dt style="margin-left:1em" class="optional">messageId<span class="property-type">string</span></dt>
        <dd style="margin-left:1.5em">ID of the stored message</dd>
        <dt style="margin-left:1em" class="optional">provisionalMessageId<span class="property-type">string</span></dt>
        <dd style="margin-left:1.5em">ID of provisional message used to retrieve asynchronous processing progress</dd>
    </dl>
    <h3>Details</h3>
    <p>The configuration settings (except for Name and Connection) are used to set the default for the parameters of the corresponding Catenis API method.</p>
    <p>The payload of the received message can be either a string or an object. If it is a string, its contents is used as the message to be logged and the default settings (as specified in the node’s configuration) are used for the other parameters.</p>
    <p>In case an object is received, the message and the options parameters are gotten from it. Any parameter present in the message payload supersedes the default settings (as specified in the node’s configuration).</p>
    <p>The data returned from a successful call to the Catenis API method are passed through the node’s single output.</p>
    <h3>References</h3>
    <ul>
        <li><a target="catenis_docs" href="https://catenis.com/docs/api">Catenis API Docs</a> - complete information about Catenis API</li>
    </ul>
</script>
