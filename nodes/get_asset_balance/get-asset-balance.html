<script type="text/javascript">
    RED.nodes.registerType('get asset balance', {
        category: 'Catenis Flow',
        color: '#9f9fe4',
        defaults: {
            name: { value: "" },
            connection: { value: "", type: "catenis api connection", required: true },
            assetId: { value: "" }
        },
        inputs:1,
        outputs:1,
        icon: "asset_balance.svg",
        label: function () {
            return this.name || "Get asset balance";
        },
        button: {
            enabled: function() {
                return !this.changed;
            },
            onclick: function() {
                if (this.changed) {
                    return RED.notify(RED._("notification.warning", {message:RED._("notification.warnings.undeployedChanges")}),"warning");
                }
                var node = this;
                $.ajax({
                    url: "catenis.getassetbalance/" + this.id,
                    type:"POST",
                    success: function(resp) {
                        RED.notify("Success", "success");
                    },
                    error: function(jqXHR,textStatus,errorThrown) {
                        if (jqXHR.status == 404) {
                            RED.notify("Error - please deploy", "error");
                        } else if (jqXHR.status == 500) {
                            RED.notify("Error - server error", "error");
                        } else if (jqXHR.status == 0) {
                            RED.notify("Error - no response", "error");
                        } else {
                            RED.notify("Error - unexpected response", "error");
                        }
                    }
                });
            }
        }
    });
</script>

<script type="text/html" data-template-name="get asset balance">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-connection"><i class="fa fa-exchange"></i> Connection</label>
        <input type="text" id="node-input-connection">
    </div>
    <div class="form-row">
        <hr>
    </div>
    <div class="form-row">
        <label for="node-input-assetId"><i class="fa fa-microchip"></i> Asset ID</label>
        <input type="text" id="node-input-assetId">
    </div>
</script>

<script type="text/html" data-help-name="get asset balance">
    <p>Call Catenis API "Get Asset Balance" method to get the current balance of a given asset held by the device.</p>
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object</span></dt>
        <dt style="margin-left:1em" class="optional">assetId<span class="property-type">string</span></dt>
        <dd style="margin-left:1.5em">ID of the asset to get balance</dd>
    </dl>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object</span></dt>
        <dt style="margin-left:1em">total<span class="property-type">number</span></dt>
        <dd style="margin-left:1.5em">Current balance of the asset held by the device</dd>
        <dt style="margin-left:1em">unconfirmed<span class="property-type">number</span></dt>
        <dd style="margin-left:1.5em">Amount from the balance that is not yet confirmed</dd>
        <dd></dd>
    </dl>
    <h3>Details</h3>
    <p>The configuration settings (except for Name and Connection) are used to set the default for the parameters of the corresponding Catenis API method.</p>
    <p>The node can be used in two modes: interactive, and run-time. In interactive mode, the end user clicks on the action button and the Catenis API method is called using the default settings (as specified in the node’s configuration).</p>
    <p>In run-time mode, the node receives a message the payload of which is an object from where the parameters are gotten. Any parameter present in the message payload supersedes the default settings (as specified in the node’s configuration).</p>
    <p>The data returned from a successful call to the Catenis API method are passed through the node’s single output.</p>
    <h3>References</h3>
    <ul>
        <li><a target="catenis_docs" href="https://catenis.com/docs/api">Catenis API Docs</a> - complete information about Catenis API</li>
    </ul>
</script>
